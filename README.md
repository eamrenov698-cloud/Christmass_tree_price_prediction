# Christmas Tree Price Prediction 

Проект по машинному обучлению для предсказания цены ёлок на основе различных характеристик.

---

## Описание проекта

Цель проекта — построить модель машинного обучения, способную предсказывать цену ёлок в зависимости от таких характеристик, как:

## Признаки

- Высота 
- Тип
- Цвет
- Материал веток
- Вес
- Оптоволокно
- Тип конструкции
- Особенности
- Количество ярусов
- Диаметр нижних веток
- Крепление нижних веток
- Сборка
- Подставка

Проект включает полный цикл работы с данными:

1. Сбор данных с помощью веб-скраппинга
2. Предварительную обработку(нормализацию, чистку)
3. Исследовательский анализ данных (EDA)
4. Построение и оценку моделей машинного обучения
5. Настройку гиперпараметров для улучшения качества предсказаний(Голосование, Стэкинг)

---

## Данные

Данные были собраны с помощью **Selenium** на сайте kaspi.kz, с использованием веб-скраппинга а также драйвера для браузера, чтобы парсировать страницу.

<img width="700" height="500" alt="image" src="https://github.com/user-attachments/assets/86c6e5c7-c293-4826-b756-881a7a7d2591" />

Процесс подготовки данных включал:

- Очистку данных (удаление пропусков, дубликатов, исправление некорректных значений)
- Преобразование категориальных переменных в числовые (One-Hot Encoding, Label Encoding)
- Масштабирование и трансформацию данных
- Разделение на тренировочный и тестовый наборы
В ходе этой работы были созданы временные файлы 'kaspitrees_prefiltered.xlsx, kaspi_products_85_done.xlsx, kaspitrees_filled.xlsx'. При желании работать с уже очищенными данными, вы можете перейти сразу к файлу
"kaspitrees_filtered.xlsx"

---

## Используемые технологии

- **Python 3**
- **Selenium, requests** — сбор данных
- **Pandas, OpenAI** — обработка данных
- **scipy** - обзор статистики
- **Matplotlib, Seaborn** — визуализация
- **Scikit-learn, XGBoostRegressor, LGBMRegressor, CatBoostRegressor** — модели машинного обучения, оценка, настройка гиперпараметров

---

## Анализ данных (EDA)
На данном этапе были:
- Построены графики распределения цен
- Проверена зависимость цены от высоты и вида ёлки
- Проанализированы сезонные колебания цен
- Выявлены выбросы и аномалии в данных

Ниже представлено распределение товаров в зависимости от цены, после чистки данных:
<img width="704" height="513" alt="image" src="https://github.com/user-attachments/assets/1426bf91-77e4-405d-9e32-6f7058451c42" />
Из-за смещенной тенденции графика, на целевую переменную была применена Логарифмическая Трансформация, для подведения модели к виду нормального распределения.

---

## Предсказание моделей
Построение моделей машинного обучения

Для предсказания цены использовались следующие модели:

- Градиентный спуск (GradientBoost)
- Случайный лес(RandomForest)
- XGBoost
- LightGBM
- CatBoost
- SVM
- Ridge


| Модель           | RMSE | R²   |
| ---------------- | ---- | ---- |
| GradientBoost    | 0.55 | 0.84 |
| RandomForest     | 0.53 | 0.85 |
| XGBoost          | 0.60 | 0.81 |
| LightGBM         | 0.57 | 0.83 |
| CatBoost         | 0.58 | 0.82 |
| Ridge            | 0.62 | 0.79 |

---

## Поиск оптимальных гиперпараметров

Для настройки был использован случайный поиск гиперпараметров RandomSearchCV, со следующим распределением параметров:

```python
param_distributions = {
    'regressor__n_estimators': [100, 200, 300, 500],
    'regressor__max_depth': [10, 20, 30, None],
    'regressor__min_samples_split': [2, 5, 10],
    'regressor__min_samples_leaf': [1, 2, 4],
    'regressor__max_features': ['sqrt', 'log2', None]
}
```
Однако, это не повлияло на улучшение качества модели. R2 и RMSE так и остались 0.85 и 0.53 соответственно.

В целях уменьшения переобучения, модель была упрощена параметрами. Наибольшее влияние на улучшение точности модели оказали генериро

## Выводы

- Модель регрессии случайного леса(RandomForestRegressor) показала наилучший результат по всем тестам.
- Лучшими параметрами для модели оказались:
```python
RandomForestRegressor(max_depth=9, min_samples_split=5, min_samples_leaf=2, max_features=20)
```
- Генерирование признаков и трансформация данных сыграли важнейшую роль в улучшении качества модели.
- Модель может быть использована для автоматического прогнозирования цен и оптимизации ассортимента магазина.
